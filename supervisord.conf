[supervisord]
nodaemon=true

[program:frontend]
# Serve the built static files and proxy any unknown routes to the backend
command=npx http-server /app/frontend/dist -p 8080 -P http://127.0.0.1:8000
directory=/app/frontend
autostart=true
autorestart=true
stderr_logfile=/var/log/frontend.err.log
stdout_logfile=/var/log/frontend.out.log

[program:backend]
# Add the -k uvicorn.workers.UvicornWorker flag
command=/usr/local/bin/gunicorn --workers 4 --bind 0.0.0.0:8000 -k uvicorn.workers.UvicornWorker app:app
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/var/log/backend.err.log
stdout_logfile=/var/log/backend.out.log